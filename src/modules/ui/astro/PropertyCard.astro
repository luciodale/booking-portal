---
import type { Locale } from "@/i18n/types";
import { defaultLocale } from "@/i18n/types";
import { t } from "@/i18n/t";
import { localePath } from "@/i18n/locale-path";
import type { Asset } from "@/db/schema";
import { formatLocation } from "@/utils/formatLocation";
import Badge from "@/modules/ui/astro/Badge.astro";

interface Props {
  asset: Asset;
  imageUrl: string;
  target?: string;
  locale?: Locale;
}

const { asset, imageUrl, target, locale = (Astro.currentLocale ?? defaultLocale) as Locale } = Astro.props;

const isElite = asset.tier === "elite";
const href = localePath(locale, isElite ? `/elite/${asset.id}` : `/property/${asset.id}`);
---

<a
  href={href}
  target={target}
  class:list={[
    "group block rounded-2xl overflow-hidden bg-card card-hover",
    { "card-elite": isElite },
  ]}
>
  <!-- Image Container -->
  <div class="relative aspect-4/3 overflow-hidden">
    <img
      src={imageUrl}
      alt={asset.title}
      class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
      loading="lazy"
    />

    <!-- Gradient Overlay -->
    <div
      class="absolute inset-0 bg-linear-to-t from-black/60 via-black/20 to-transparent opacity-60 group-hover:opacity-80 transition-opacity duration-300"
    >
    </div>

    <!-- Tier Badge -->
    <div class="absolute top-4 left-4">
      <Badge variant={asset.tier} />
    </div>

  </div>

  <!-- Content -->
  <div class="p-5">
    <h3
      class="text-lg font-semibold text-foreground mb-1 group-hover:text-primary transition-colors duration-200"
    >
      {asset.title}
    </h3>

    <p class="text-muted-foreground text-sm mb-4 flex items-center gap-1">
      <i data-lucide="map-pin" class="w-4 h-4"></i>
      {formatLocation(asset)}
    </p>

    <!-- Amenities -->
    <div class="flex items-center gap-4 text-muted-foreground text-sm">
      {
        asset.bedrooms && (
          <div class="flex items-center gap-1.5">
            <i data-lucide="bed-double" class="w-4 h-4" />
            {asset.bedrooms} {asset.bedrooms !== 1 ? t(locale, "common.beds") : t(locale, "common.bed")}
          </div>
        )
      }
      {
        asset.bathrooms && (
          <div class="flex items-center gap-1.5">
            <i data-lucide="bath" class="w-4 h-4" />
            {asset.bathrooms} {asset.bathrooms !== 1 ? t(locale, "common.baths") : t(locale, "common.bath")}
          </div>
        )
      }
      {
        asset.maxOccupancy && (
          <div class="flex items-center gap-1.5">
            <i data-lucide="users" class="w-4 h-4" />
            {asset.maxOccupancy} {asset.maxOccupancy !== 1 ? t(locale, "common.guests") : t(locale, "common.guest")}
          </div>
        )
      }
    </div>
  </div>
</a>
