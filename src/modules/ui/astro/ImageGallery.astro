---
interface Props {
  images: string[];
  title: string;
  variant?: "standard" | "elite";
}

const { images, title, variant = "standard" } = Astro.props;
const isElite = variant === "elite";
---

<astro-gallery class="block" data-images={JSON.stringify(images)}>
  {
    isElite ? (
      <div class="grid grid-cols-12 gap-4">
        <button
          type="button"
          class="col-span-8 row-span-2 relative aspect-4/3 rounded-2xl overflow-hidden group cursor-pointer gallery-trigger"
          data-gallery-index="0"
          aria-label={`View ${title} - Image 1`}
        >
          <img
            src={images[0]}
            alt={`${title} - Main View`}
            class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
          />
          <div class="absolute inset-0 bg-linear-to-t from-black/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity" />
          <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
            <div class="w-16 h-16 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
              <svg
                class="w-8 h-8 text-white"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"
                />
              </svg>
            </div>
          </div>
        </button>

        {images.slice(1, 3).map((img, idx) => (
          <button
            type="button"
            class="col-span-4 relative aspect-4/3 rounded-2xl overflow-hidden group cursor-pointer gallery-trigger"
            data-gallery-index={idx + 1}
            aria-label={`View ${title} - Image ${idx + 2}`}
          >
            <img
              src={img}
              alt={`${title} - View ${idx + 1}`}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            />
            <div class="absolute inset-0 bg-linear-to-t from-black/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity" />
          </button>
        ))}

        {images.slice(3, 6).map((img, idx) => (
          <button
            type="button"
            class:list={[
              "col-span-4 relative aspect-4/3 rounded-2xl overflow-hidden group cursor-pointer gallery-trigger",
            ]}
            data-gallery-index={idx + 3}
            aria-label={`View ${title} - Image ${idx + 4}`}
          >
            <img
              src={img}
              alt={`${title} - View ${idx + 3}`}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            />
            <div class="absolute inset-0 bg-linear-to-t from-black/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity" />
            {idx === 2 && images.length > 6 && (
              <div class="absolute inset-0 bg-black/60 flex items-center justify-center hover:bg-black/70 transition-colors">
                <span class="text-white font-semibold text-lg">
                  +{images.length - 6} more
                </span>
              </div>
            )}
          </button>
        ))}
      </div>
    ) : (
      <div class="grid grid-cols-4 grid-rows-2 gap-3 h-[500px] rounded-2xl overflow-hidden">
        <button
          type="button"
          class="relative col-span-2 row-span-2 overflow-hidden group cursor-pointer gallery-trigger"
          data-gallery-index="0"
          aria-label={`View ${title} - Image 1`}
        >
          <img
            src={images[0]}
            alt={title}
            class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
          />
          <div class="absolute inset-0 bg-linear-to-t from-black/40 via-transparent to-transparent" />
        </button>

        {images.slice(1, 5).map((img, idx) => (
          <button
            type="button"
            class="relative overflow-hidden group cursor-pointer gallery-trigger"
            data-gallery-index={idx + 1}
            aria-label={`View ${title} - Image ${idx + 2}`}
          >
            <img
              src={img}
              alt={`${title} - Image ${idx + 2}`}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            />
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors" />
            {idx === 3 && images.length > 5 && (
              <div class="absolute inset-0 bg-black/60 flex items-center justify-center hover:bg-black/70 transition-colors">
                <span class="text-white font-semibold text-lg">
                  +{images.length - 5} more
                </span>
              </div>
            )}
          </button>
        ))}
      </div>
    )
  }

  <div class="mt-8 flex justify-center">
    <button
      type="button"
      class:list={[
        "gallery-trigger inline-flex items-center gap-3 px-6 py-3.5 text-sm font-medium transition-all group",
        isElite
          ? "bg-card border border-border rounded-full text-foreground hover:border-primary/50 hover:bg-card-hover"
          : "bg-secondary hover:bg-card-hover rounded-xl text-foreground",
      ]}
      data-gallery-index="0"
    >
      <svg
        class="w-5 h-5 text-primary"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
        ></path>
      </svg>
      <span>View Full Gallery</span>
      <span class="text-muted-foreground">({images.length} photos)</span>
    </button>
  </div>
</astro-gallery>

<script>
  // Custom element to dispatch gallery events
  class AstroGallery extends HTMLElement {
    constructor() {
      super();

      const imagesData = this.dataset.images;
      if (!imagesData) return;

      const images: string[] = JSON.parse(imagesData);
      const triggers = this.querySelectorAll(".gallery-trigger");

      triggers.forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          const index = parseInt(
            (btn as HTMLElement).dataset.galleryIndex || "0",
          );

          // Dispatch event to the Global Lightbox
          document.dispatchEvent(
            new CustomEvent("open-gallery", {
              detail: { images, index },
            }),
          );
        });
      });
    }
  }

  // Register the custom element
  customElements.define("astro-gallery", AstroGallery);
</script>
